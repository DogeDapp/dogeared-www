function dogeared_omgwtf(a){console.log(a)}function dogeared_init(){window.addEventListener("offline",dogeared_on_offline);window.addEventListener("online",dogeared_on_online);$("a").click(function(){if(!dogeared_network_is_online()){$(this).html()=="reading list"&&dogeared_documents_load_cache();return false}});dogeared_network_init();dogeared_appcache_init();dogeared_highlights_init();dogeared_cache_highlights_init();dogeared_whosonfirst_init();dogeared_init_touch_controls()}
function dogeared_init_touch_controls(){$(document).touchwipe({wipeLeft:dogeared_on_swipe,wipeRight:dogeared_on_swipe,wipeUp:function(){},wipeDown:function(){},min_move_x:100,min_move_y:100,preventDefaultEvents:false,allowPageScroll:"vertical"})}function dogeared_on_swipe(){if(!dogeared_documents_currently_reading())return false;dogeared_omgwtf("swipe: load index");dogeared_documents_load_index()}function dogeared_abs_root_url(){return document.body.getAttribute("data-abs-root-url")}
function dogeared_now(){var a=(new Date).getTime();return a=parseInt(a/1E3)}function dogeared_on_online(a){doeared_omgwtf("came online at "+a.timeStamp);dogeared_feedback("You appear to be online again.");$(".appcache_equals_no").show()}function dogeared_on_offline(a){dogeared_omgwtf("went offline at "+a.timeStamp);dogeared_feedback("You appear to be offline.");$(".appcache_equals_no").hide()}
function dogeared_whosonfirst_init(){dogeared_omgwtf("whosonfirst init");var a=dogeared_whosonfirst_key();store.get(a)||store.set(a,{})}function dogeared_whosonfirst_key(){return"dogeared_whosonfirst"}function dogeared_whosonfirst_get(a){var b=dogeared_whosonfirst_key();return store.get(b)[a]}function dogeared_whosonfirst_set(a,b){var c=dogeared_whosonfirst_key(),e=store.get(c);e[a]=b;store.set(c,e)};function dogeared_network_init(){window.addEventListener("offline",dogeared_network_on_offline);window.addEventListener("online",dogeared_network_on_online);dogeared_network_status()}function dogeared_network_is_online(){return navigator.onLine}function dogeared_network_on_online(){dogeared_network_status();$(".btn-save-highlight").removeAttr("disabled")}function dogeared_network_on_offline(){dogeared_network_status();$(".btn-save-highlight").attr("disabled","disabled")}
function dogeared_network_status(){var a=$("#feedback-network-status");dogeared_network_is_online()?a.html("you are awake and connected to the network"):a.html("you are playing hide-and-go-seek with the sky and the sky is winning.")};var dogeared_appcache_progress=0;
function dogeared_appcache_init(){window.applicationCache.addEventListener("cached",dogeared_appcache_on_event,false);window.applicationCache.addEventListener("checking",dogeared_appcache_on_event,false);window.applicationCache.addEventListener("downloading",dogeared_appcache_on_event,false);window.applicationCache.addEventListener("error",dogeared_appcache_on_error,false);window.applicationCache.addEventListener("noupdate",dogeared_appcache_on_event,false);window.applicationCache.addEventListener("obsolete",dogeared_appcache_on_event,
false);window.applicationCache.addEventListener("progress",dogeared_appcache_on_event,false);window.applicationCache.addEventListener("updateready",dogeared_appcache_on_updateready,false)}function dogeared_appcache_on_event(a){a=a.type;if(a=="checking")dogeared_appcache_progress=0;else if(a=="progress"){dogeared_appcache_progress+=1;dogeared_network_is_online()&&dogeared_feedback("checking for updates ("+dogeared_appcache_progress+")")}else dogeared_feedback_reset()}
function dogeared_appcache_on_error(a){console.log("appcache error");console.log(a)}function dogeared_appcache_on_updateready(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY)if(!dogeared_documents_currently_reading()){console.log("appcache onupdateready reload");window.location.reload()}}function dogeared_appcache_status_code(){return window.applicationCache.status}
function dogeared_appcache_status(){switch(dogeared_appcache_status_code()){case window.applicationCache.UNCACHED:return"UNCACHED";case window.applicationCache.IDLE:return"IDLE";case window.applicationCache.CHECKING:return"CHECKING";case window.applicationCache.DOWNLOADING:return"DOWNLOADING";case window.applicationCache.UPDATEREADY:return"UPDATEREADY";case window.applicationCache.OBSOLETE:return"OBSOLETE";default:return"UKNOWN CACHE STATUS"}};var de_feedback_timeout=null;function dogeared_feedback_ok(a,b){dogeared_feedback(a);b||(b=10);b*=1E3;de_feedback_timeout&&clearTimeout(de_feedback_timeout);de_feedback_timeout=setTimeout(function(){dogeared_feedback_reset()},b)}function dogeared_feedback_error(a){dogeared_feedback(a)}function dogeared_feedback_api_error(a){dogeared_feeback_error(a.error.message)}function dogeared_feedback_modal(a){dogeared_feedback_ok(a,10);alert(a)}function dogeared_feedback(a){$("#feedback-general").html(a)}
function dogeared_feedback_reset(){$("#feedback-general").html("")};function dogeared_api_call(a,b,c,e){var d=b.append?1:0;if(d){b.append("method",a);b.access_token||b.append("access_token",dogeared_api_site_token())}else{b.method=a;b.access_token||(b.access_token=dogeared_api_site_token())}a={url:dogeared_api_endpoint(),type:"POST",data:b,dataType:"json",success:function(f){dogeared_omgwtf(f);c&&c(f)},error:function(f){dogeared_omgwtf(f);if(f=function(g){if(g.responseText)try{return g=JSON.parse(g.responseText)}catch(j){console.log("Failed to parse response text");
dogeared_feedback_error("The API is full of crazy-talk: Failed to parse response text")}else{console.log("Missing response text");console.log(g);dogeared_feedback_error("The API is full of crazy-talk: Missing response text")}}(f))f.error?dogeared_feedback_error("The API is sad: "+f.error.message):dogeared_feedback(f);e&&e(f)}};if(d){a.cache=false;a.contentType=false;a.processData=false}$.ajax(a)}function dogeared_api_endpoint(){return document.body.getAttribute("data-api-endpoint")}
function dogeared_api_site_token(){return document.body.getAttribute("data-api-site-token")};function dogeared_extruder_init(){window.addEventListener("offline",function(a){dogeared_extruder_on_offline(a)});window.addEventListener("online",function(a){dogeared_extruder_on_online(a)});$("#fetch").submit(function(){var a=$("#url");a=a.val();dogeared_api_call("dogeared.documents.addDocument",{url:a},function(b){var c=b.document.id;c='Okay! <a href="'+(dogeared_abs_root_url()+"documents/"+c+"/")+'">That document</a> is ready to be dogeared.';dogeared_feedback_ok(c,60);$("#button-dogear").removeAttr("disabled");
dogeared_cache_documents_store(b.document);$("#url").val("")});dogeared_feedback("Fetching your document, now...");$("#button-dogear").attr("disabled","disabled");return false});dogeared_network_is_online()||dogeared_extruder_hide_form()}function dogeared_extruder_on_online(){dogeared_extruder_show_form()}function dogeared_extruder_on_offline(){dogeared_extruder_hide_form()}function dogeared_extruder_show_form(){$("#fetch").show()}function dogeared_extruder_hide_form(){$("#fetch").hide()};var dogeared_fill_cache_count=0;function dogeared_documents_init(){window.addEventListener("offline",function(a){dogeared_documents_on_offline(a)});window.addEventListener("online",function(a){dogeared_documents_on_online(a)});dogeared_documents_load_index()}function dogeared_documents_on_online(){dogeared_omgwtf("documents: online");dogeared_documents_process_to_delete()}
function dogeared_documents_on_offline(){dogeared_omgwtf("documents: offline");dogeared_documents_currently_reading()||dogeared_documents_load_cache()}
function dogeared_documents_process_to_delete(){var a=store.get("dogeared_to_delete");for(id in a){dogeared_omgwtf("process pending delete for document "+id);if(id)dogeared_api_call("dogeared.documents.deleteDocument",{document_id:id},function(){var b=store.get("dogeared_to_delete");delete b[id];store.set("dogeared_to_delete",b)});else{delete a[id];store.set("dogeared_to_delete",a)}}}
function dogeared_documents_load_index(){if(dogeared_network_is_online())try{dogeared_documents_fill_cache(function(){var b=function(){if(dogeared_fill_cache_count){dogeared_feedback("Loading documents, "+dogeared_fill_cache_count+" left");setTimeout(b,500)}else dogeared_documents_load_cache()};b()})}catch(a){dogeared_feedback_error("Oh no! There was a problem loading your documents: "+a);console.log(a)}else dogeared_documents_load_cache();dogeared_document_unbind_highlight_controls()}
function dogeared_documents_init_delete_controls(){dogeared_omgwtf("init documents delete controls");var a=function(b){if(!confirm("Are you sure you want to remove this document?"))return false;var c=b.attr("data-document-id");if(!c){alert("Unable to determine document ID");return false}dogeared_omgwtf("delete document "+c);if(!dogeared_network_is_online()){(b=store.get("dogeared_to_delete"))||(b={});b[c]=true;store.set("dogeared_to_delete",b);b=$("#dogeared-document-"+c);b.remove();dogeared_feedback_modal("Okay. That document has been queued for deletion.");
return false}dogeared_api_call("dogeared.documents.deleteDocument",{document_id:c},function(){$("#dogeared-document-"+c).remove();store.remove("dogeared_"+c);dogeared_feedback("Okay, that document has been removed from your reading list");dogeared_documents_load_index()});b=$("#dogeared-document-"+c);b.remove()};$(".delete-document").click(function(){dogeared_omgwtf("click to delete");try{var b=$(this);a(b)}catch(c){dogeared_feedback_error("Huh. Deleting your document failed because: "+c)}})}
function dogeared_documents_load_cache(){dogeared_omgwtf("load documents cache");dogeared_feedback_reset();window.scrollTo(0,0);var a=store.get("dogeared_to_delete"),b=dogeared_cache_documents(),c=b.length;if(c==0)return false;b=dogeared_documents_sort(b);$(".excerpt").remove();$(".document").remove();var e=$("#documents");dogeared_abs_root_url();for(var d=0;d<c;d++){var f=b[d],g=f.id;if(g)if(a&&a[g])dogeared_omgwtf("skipping document "+g+" because it is set to be deleted");else{var j=f.display_title;
if(j==undefined)j="Unknown title #"+g;dogeared_omgwtf("load "+j+" ("+g+") "+f.created);var k=dogeared_abs_root_url();k+="documents/"+g+"/";var h='<div class="row excerpt"';h+=' id="dogeared-document-'+g+'"';h+=">";h+='<h3><a href="';h+=k;h+='" class="load-doc" data-document-id="';h+=htmlspecialchars(g);h+='">';h+=htmlspecialchars(j);h+="</a>";h+=" <pre><small>"+htmlspecialchars(f.url)+"</small></pre>";h+="</h3>";h+="<div>";h+='<button class="btn btn-sm delete-document pull-right" data-document-id="';
h+=g;h+='" data-button-action="delete">Delete</button>';h+="</div>";h+="</div>";e.append(h)}}$(".load-doc").click(function(){try{dogeared_network_is_online();var l=$(this).attr("data-document-id");dogeared_documents_load_doc(l)}catch(m){dogeared_feedback("Failed to load document because "+m);console.log(m)}return false});dogeared_documents_init_delete_controls();dogeared_document_init()}
function dogeared_documents_get_text(a){var b=a.document_id;if(b=="0")return false;dogeared_api_call("dogeared.documents.getInfo",{document_id:b,lastmodified:a.lastmodified},function(c){c=c.document;var e=dogeared_cache_documents_store(c);dogeared_omgwtf("store "+c.display_title+" ("+c.id+") "+e);dogeared_documents_fill_cache_decr()},function(){dogeared_documents_fill_cache_decr()});dogeared_documents_fill_cache_incr()}
function dogeared_documents_store_docs(a){dogeared_documents_fill_cache_reset();for(i in a)dogeared_documents_get_text(a[i])}function dogeared_documents_fill_cache_reset(){dogeared_fill_cache_count=0}function dogeared_documents_fill_cache_incr(){dogeared_fill_cache_count+=1}function dogeared_documents_fill_cache_decr(){if(dogeared_fill_cache_count)dogeared_fill_cache_count-=1}
function dogeared_documents_fill_cache(a){for(var b={},c=dogeared_cache_documents(),e=c.length,d=0;d<e;d++)b[c[d].id]=c[d].lastmodified;dogeared_feedback("Fetching documents");dogeared_api_call("dogeared.documents.getList",{},function(f){dogeared_feedback("Storing documents");f=f.documents.document;var g=f.length;dogeared_documents_store_docs(f);dogeared_feedback("Cleaning up document cache");for(var j=0;j<g;j++){var k=f[j].document_id;b[k]&&delete b[k]}for(k in b)store.remove("dogeared_"+k);dogeared_feedback_reset();
a&&a()},function(){})}function dogeared_documents_sort(a){a=usort(a,function(b,c){if(b.created==c.created)return 0;return b.created>c.created?-1:1});return a=array_values(a)}function dogeared_documents_currently_reading(){return $("#document").html()?1:0}
function dogeared_documents_load_doc(a){var b=store.get("dogeared_"+a),c=b.display_title;if(c==undefined)c="Unknown title #"+a;var e=JSON.parse(b.body);b=htmlspecialchars(b.url);var d='<div class="document" id="document"';d+=' data-document-id="';d+=htmlspecialchars(a);d+='">';d+='<div class="row">';d+="<h3>";d+=htmlspecialchars(c);d+="</h3>";d+=" <pre><small>"+b+"</small></pre>";d+="</div>";d+='<div class="row">';for(var f in e){d+="<p>";d+=htmlspecialchars(e[f]);d+="</p>"}d+="</div>";d+='<div class="row">';
d+=" <pre><small>"+b+"</small></pre>";d+="</div>";d+="<div>";d+='<a href="">reading list</a>';d+="</div>";d+="</div>";$("#documents").append(d);$(".excerpt").remove();dogeared_document_init_doc(a)};var current_selection="",highlight_controls=0;function dogeared_document_init(){console.log("document init")}function dogeared_document_init_doc(a){console.log("document init (doc) "+a);window.onscroll=dogeared_document_on_scroll;(a=dogeared_whosonfirst_get(a))&&window.scrollTo(0,a);dogeared_document_bind_highlight_controls()}function dogeared_document_on_scroll(){var a=$("#document").attr("data-document-id");a&&dogeared_whosonfirst_set(a,window.scrollY)}
function dogeared_document_bind_highlight_controls(){dogeared_omgwtf("bind highlight controls");if(typeof window.ontouchend=="object"){dogeared_omgwtf("init touch based highlight controls");$(document).bind("selectionchange",dogeared_document_selected_selectionchange)}else{dogeared_omgwtf("init mouse based highlight controls");$(document).bind("mouseup",dogeared_document_selected_mouseup)}}
function dogeared_document_unbind_highlight_controls(){dogeared_omgwtf("unbind highlight controls");typeof window.ontouchend=="object"?$(document).unbind("selectionchange",dogeared_document_selected_selectionchange):$(document).unbind("mouseup",dogeared_document_selected_mouseup)}
function dogeared_document_selected_mouseup(a){console.log("document: on mouseup");a=a.target;if(a.nodeName=="BUTTON"){a=$(a);a.attr("data-button-action")=="delete"?console.log("mouse up: ignore delete button"):dogeared_document_add_highlight()}else{$(".highlight").remove();var b=window.getSelection();if(b.toString()!=""){range=window.getSelection().getRangeAt(0);expandedSelRange=range.cloneRange();range.collapse(false);a=document.createElement("div");a.innerHTML='<span class="highlight"> <button id="highlight" class="btn btn-sm">Highlight</button> </span>';
for(var c=document.createDocumentFragment(),e,d;e=a.firstChild;)d=c.appendChild(e);range.insertNode(c);if(d){expandedSelRange.setEndAfter(d.previousSibling);b.removeAllRanges();b.addRange(expandedSelRange)}}}}
function dogeared_document_selected_selectionchange(){console.log("on selectionchange");$(".highlight").remove();var a=window.getSelection().toString();if(a!=""){current_selection=a;range=window.getSelection().getRangeAt(0);expandedSelRange=range.cloneRange();range.collapse(false);a=document.createElement("div");a.innerHTML='<span class="highlight"> <button id="highlight" class="btn btn-sm">Highlight</button> </span>';for(var b=document.createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);
range.insertNode(b);$("#highlight").click(dogeared_document_add_highlight)}}
function dogeared_document_add_highlight(){var a=$("#document").attr("data-document-id");if(!a){dogeared_feedback_error("Unable to determine what document I am looking at!");return false}var b=window.getSelection();b=current_selection?current_selection:b.toString();a={document_id:a,text:b};if(dogeared_network_is_online())dogeared_api_call("dogeared.highlights.addHighlight",a,function(c){c.stat!="ok"?dogeared_feedback_api_error(c):dogeared_feedback_modal("Your highlight has been added.")});else if(dogeared_cache_highlights_store(a)){dogeared_feedback_modal("Your highlight has been cached.");
dogeared_cache_highlights_status()}};function dogeared_highlights_init(){window.addEventListener("online",function(){dogeared_highlights_on_online()})}function dogeared_highlights_on_online(){dogeared_highlights_flush_pending()}function dogeared_highlights_flush_pending(){console.log("flush pending highlights");for(var a=dogeared_cache_highlights(),b=a.length,c=0;c<b;c++)dogeared_highlights_flush_pending_single(a[c])}
function dogeared_highlights_flush_pending_single(a){var b=a.cache_key;console.log("flush pending highlight "+b);dogeared_api_call("dogeared.highlights.addHighlight",{document_id:a.document_id,text:a.text,created:a.created},function(){store.remove(b);dogeared_cache_highlights_status()})}
function dogeared_highlights_init_list(){$(".delete-highlight").click(function(){if(!confirm("Are you sure you want to delete this highlight?"))return false;var a=$(this).attr("data-highlight-id");dogeared_api_call("dogeared.highlights.deleteHighlight",{id:a},function(){$("#highlight-"+a).remove();dogeared_feedback("That highlight has been deleted.")})})}
function dogeared_highlights_init_single(){$(".delete-highlight").click(function(){if(!confirm("Are you sure you want to delete this highlight?"))return false;var a={id:$(this).attr("data-highlight-id")};dogeared_api_call("dogeared.highlights.deleteHighlight",a,function(){var b=dogeared_abs_root_url()+"highlights/?deleted=1";location.href=b})})};var notepad_interval=null,notepad_inprocess_sync=[],notepad_pending_sync=[];function dogeared_notepad_init(){window.addEventListener("online",dogeared_notepad_on_online);$("#notes-list").html("Wranging your notepad and comparing it to the sky. Tasteful Muzak plays.");dogeared_feedback("Building notes lists.");dogeared_network_is_online()?dogeared_notepad_sync_list():dogeared_notepad_build_list()}
function dogeared_notepad_on_online(){notepad_pending_sync.length&&dogeared_notepad_sync_notes(notepad_pending_sync)}function dogeared_notepad_add_note(){var a=prompt("What is the title of your note?");if(!a)return false;var b=Math.uuid(),c=dogeared_now(),e=dogeared_notepad_source();a={id:b,source_id:e,created:c,lastmodified:0,deleted:0,title:a,body:"This note left intentionally blank."};b=dogeared_notepad_key(a);store.set(b,a);dogeared_notepad_load_note(b)}
function dogeared_notepad_load_note(a){var b=store.get(a),c=$("#notes-list"),e=$("#note-editor"),d=$("#note-editor-close"),f=$("#note-editor-delete");e.attr("data-note-id",a);$("#note-title").html(b.title);$("#note-body").html(b.body);d.click(function(){dogeared_notepad_close_note();return false});f.click(function(){if(!confirm("Are you sure you want to delete this note?"))return false;dogeared_notepad_delete_note();dogeared_notepad_build_list();return false});c.hide();e.show();notepad_interval=setInterval(function(){dogeared_notepad_save_note()},
3E4)}function dogeared_notepad_save_note(){if(note=dogeared_notepad_get_current_note()){var a=dogeared_notepad_key(note),b=false,c=$("#note-title");c=c.text();var e=$("#note-body");e=e.html();if(note.title!=c){note.title=c;b=true}if(note.body!=e){note.body=e;b=true}if(b){b=dogeared_now();note.lastmodified=b;console.log("update "+a);store.set(a,note);dogeared_notepad_sync_note(note)}}}
function dogeared_notepad_delete_note(){if(note=dogeared_notepad_get_current_note()){clearInterval(notepad_interval);var a=dogeared_notepad_key(note),b=dogeared_now();note.title="[redacted]";note.body="";note.deleted=b;note.lastmodified=b;console.log("delete "+a);store.set(a,note);dogeared_feedback_modal("This note has been deleted");dogeared_notepad_sync_note(note)}}
function dogeared_notepad_close_note(){notepad_interval&&clearInterval(notepad_interval);dogeared_notepad_save_note();$("#note-editor").hide();dogeared_notepad_build_list()}
function dogeared_notepad_build_list(){var a=[];store.forEach(function(h,l){if(h.split("_")[0]=="notepad"){l.id||store.remove(h);parseInt(l.deleted)||a.push(l)}});a=dogeared_notepad_sort(a);for(var b=$("#note-editor"),c=$("#notes-list"),e="",d=a.length,f=0;f<d;f++){var g=a[f],j="notepad_"+g.id,k=g.title;g=g.source_id;e+="<li>";e+='<a href="#" class="note-item" data-note-key="'+j+'">'+k+"</a> ";e+=parseInt(g)?"<small>device id #"+g+"</small>":"<small>unknown source</small>";e+="</li>"}e+='<li><a href="#" id="note-add">Add a note</a></li>';
c.html(e);$("#note-add").click(function(){dogeared_notepad_add_note();return false});$(".note-item").click(function(){var h=$(this).attr("data-note-key");dogeared_notepad_load_note(h);return false});b.hide();c.show()}
function dogeared_notepad_sync_list(){dogeared_feedback("Synching local documents in progress");store.forEach(function(b,c){b.split("_")[0]=="notepad"&&dogeared_notepad_sync_note(c)});var a=setInterval(function(){if(!notepad_inprocess_sync.length){dogeared_feedback_ok("Syncing local documents complete",5);clearInterval(a);dogeared_notepad_get_list()}},1E3)}
function dogeared_notepad_get_list(){dogeared_feedback("Synching remote documents in progress");dogeared_api_call("dogeared.notepad.getList",{},function(a){a=a.notes.note;for(var b=a.length,c=0;c<b;c++){var e=a[c],d=dogeared_notepad_key(e);if(!store.get(d)){console.log("add "+d);store.set(d,e)}}dogeared_feedback("Synching remote documents complete",5);dogeared_notepad_build_list()},function(){dogeared_feedback_error("Synching remote documents failed, so just loading local ones");dogeared_notepad_build_list()})}
function dogeared_notepad_sync_pending_notes(a){for(id in a){var b=dogeared_notepad_key({id:id});b=store.get(b);dogeared_notepad_sync_note(b)}}
function dogeared_notepad_sync_note(a){var b=a.id;if(!dogeared_network_is_online()){notepad_pending_sync[b]=true;return false}delete notepad_pending_sync[b];if(notepad_inprocess_sync[b]==true)return false;notepad_inprocess_sync[b]=true;a={note:JSON.stringify(a)};dogeared_api_call("dogeared.notepad.syncNote",a,function(c){c=c.note;var e=c.id,d=dogeared_notepad_key(c);store.set(d,c);notepad_inprocess_sync[e]=false},function(){notepad_inprocess_sync[b]=false})}
function dogeared_notepad_get_current_note(){var a=$("#note-editor").attr("data-note-id");if(a){var b=store.get(a);if(b)return b;else{dogeared_feedback_error("Failed to load "+a+" which is weird because I am trying to save it...");clearInterval(notepad_interval)}}else clearInterval(notepad_interval)}function dogeared_notepad_key(a){return"notepad_"+a.id}function dogeared_notepad_source(){return(new Fingerprint).get()}
function dogeared_notepad_sort(a){a=usort(a,function(b,c){if(b.lastmodified==c.lastmodified)return 0;return b.lastmodified>c.lastmodified?-1:1});return a=array_values(a)};function dogeared_cache_count_for_type(a){var b=0;store.forEach(function(c){if(c.split("_")[0]==a)b+=1});return b}function dogeared_cache_get_for_type(a){var b=[];store.forEach(function(c,e){if(c.split("_")[0]==a){e.cache_key=c;b.push(e)}});return b};function dogeared_cache_documents_store(a){if(!store.enabled){console.log("localstorage is not enabled");return false}var b=a.id;return store.set("dogeared_"+b,a).id==b?1:0}function dogeared_cache_documents(){return dogeared_cache_get_for_type("dogeared")};function dogeared_cache_highlights_init(){dogeared_cache_highlights_status()}function dogeared_cache_highlights_store(a){if(!store.enabled){console.log("localstorage is not enabled");return false}var b=hex_md5(a.text);a.hash=b;b="highlight_"+b;console.log("store "+b);console.log(a);store.set(b,a);return true}function dogeared_cache_highlights_remove_key(a){store.remove(a)}
function dogeared_cache_highlights_status(){var a=$("#feedback-pending-highlights"),b=dogeared_cache_count_for_type("highlight");if(b==1){var c=dogeared_abs_root_url()+"highlights/pending/";a.html('there are <a href="'+c+'">pending highlights</a>.');a.show()}else if(b){c=dogeared_abs_root_url()+"highlights/pending/";a.html('there are <a href="'+c+'">'+b+" pending highlights</a>.");a.show()}else{a.html("");a.hide()}}
function dogeared_cache_highlights(){return dogeared_cache_get_for_type("highlight")};
